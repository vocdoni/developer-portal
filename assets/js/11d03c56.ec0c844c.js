"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[8759],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=c(n),h=a,d=m["".concat(l,".").concat(h)]||m[h]||p[h]||r;return n?o.createElement(d,i(i({ref:t},u),{},{components:n})):o.createElement(d,i({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},78989:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var o=n(87462),a=(n(67294),n(3905));const r={},i="On-Chain Census Anonymity",s={unversionedId:"protocol/anonymity/on-chain",id:"protocol/anonymity/on-chain",title:"On-Chain Census Anonymity",description:"On-chain cenuses created with the Census3 Service derive their contents from a public set of holders of a given token (or set of tokens) on the Ethereum blockchain. This information is turned into a census by generating a Merkle Proof on that set of data. This Merkle Proof is similar to that used for a typical off-chain tree census, and the same sort of ZK Census Proof can be used to compute voter validation anonymously.",source:"@site/docs/protocol/anonymity/on-chain.md",sourceDirName:"protocol/anonymity",slug:"/protocol/anonymity/on-chain",permalink:"/protocol/anonymity/on-chain",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"CSP Blind Signatures",permalink:"/protocol/anonymity/blind-signatures"},next:{title:"Off-Chain Tree ZK Census Proof",permalink:"/protocol/anonymity/zk-census-proof"}},l={},c=[{value:"Rounding Censuses",id:"rounding-censuses",level:2},{value:"Basic Steps",id:"basic-steps",level:3},{value:"Results Accuracy",id:"results-accuracy",level:2},{value:"Anonymity Level",id:"anonymity-level",level:2}],u={toc:c};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"on-chain-census-anonymity"},"On-Chain Census Anonymity"),(0,a.kt)("p",null,"On-chain cenuses created with the Census3 Service derive their contents from a public set of holders of a given token (or set of tokens) on the Ethereum blockchain. This information is turned into a census by generating a Merkle Proof on that set of data. This Merkle Proof is similar to that used for a typical off-chain tree census, and the same sort of ",(0,a.kt)("a",{parentName:"p",href:"/protocol/anonymity/zk-census-proof"},"ZK Census Proof")," can be used to compute voter validation anonymously."),(0,a.kt)("p",null,"Unfortunately a zero-knowledge census itself is not enough to anonymize an on-chain election, because voters are weighted according to their unique token balances, making them easy to identify as the weight of a vote can be correlated with an address. We address this problem by rounding voter weights in order to hide unique token balances."),(0,a.kt)("admonition",{title:"ethereum storage proofs",type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"On-chain censuses created manually with ",(0,a.kt)("a",{parentName:"p",href:"/protocol/census/on-chain#erc-20-token-storage-proofs"},"Ethereum Storage Proofs")," cannot be anonymized")),(0,a.kt)("h2",{id:"rounding-censuses"},"Rounding Censuses"),(0,a.kt)("p",null,"To ensure that the balances of token-based censuses remain private, we must alter them in some way. However, any change must meet two requirements:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The resulting balance must be less than or equal to the original one.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The resulting balance should stay as close to the original as possible."))),(0,a.kt)("p",null,"Our algorithm rounds balances to a nearby value, forming groups of equal rounded balance of a least some ",(0,a.kt)("inlineCode",{parentName:"p"},"privacyThreshold")," in size (minimum 3). This process obscures individual holder's balances. The algorithm optimizes the number of members in a group, taking in account the difference between balances, to reduce accuracy loss."),(0,a.kt)("h3",{id:"basic-steps"},"Basic Steps"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Identify and exclude outliers: Participants balances are analyzed to detect outliers using z-score algorithm.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Forming groups: Participants are initially grouped based on the privacy threshold. A group can extend to include participants with identical balances or with balances differences falling below the groupBalanceDiff criteria.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Balancing groups: For each group, we adjust the balances, rounding them down to the smallest amount within the group to obscure individual values.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Accuracy loop: The algorithm tries to find the highest accuracy possible while maintaining a minimum privacy threshold. It starts with the minimum privacy threshold and increases it by a small amount until the accuracy is maximized."))),(0,a.kt)("h2",{id:"results-accuracy"},"Results Accuracy"),(0,a.kt)("p",null,"Because voter weights are rounded, there is a chance for the accuracy of elections to be affected."),(0,a.kt)("p",null,"To measure accuracy, we compare the total of the adjusted balances from the census against the sum of the original balances, incorporating outliers into both calculations for consistency."),(0,a.kt)("p",null,"Our tests covered censuses involving 21 different tokens, showcasing various holder counts and token formats, including ERC20, ERC721, and POAP. This comprehensive testing ensures our approach is robust across different Web3 assets."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://blog.vocdoni.io/_next/image?url=https%3A%2F%2Fstorage.googleapis.com%2Fpapyrus_images%2F1b54084ccc29b051ca00d4d31c02328c.png&w=1920&q=75",alt:"accuracy-testing"})),(0,a.kt)("p",null,"Evidently, accuracy cannot be maintained under all possible conditions. We've established parameter settings that generally perform well across various token types and distributions, and under these conditions we consider accuracy levels to be sufficient. "),(0,a.kt)("h2",{id:"anonymity-level"},"Anonymity Level"),(0,a.kt)("p",null,"This scheme for token-based census anonymity is not as absolutely anonymous as a zk-merkle-proof. The parameter settings are important- a ",(0,a.kt)("inlineCode",{parentName:"p"},"privacyThreshold")," that is too small could result in a rounded group of voters who all vote for the same result, effectively de-anonymizing every member of the group. If this threshold is too high, however, accuracy is lost."),(0,a.kt)("p",null,"There are also potential vulnerabilities to specific attacks. For example, acquiring a certain amount of a token to manipulate the algorithm into grouping an address with others could theoretically expose that address. However, such strategies are impractical and unlikely to significantly impact election outcomes. This type of attack also requires an analysis of balance distributions, complicating its execution."))}p.isMDXComponent=!0}}]);